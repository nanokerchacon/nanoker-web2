<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Nanoker | Partner Access</title>

  <!-- Favicons -->
  <link rel="icon" type="image/png" sizes="32x32" href="./favicon-pack/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="./favicon-pack/favicon-16x16.png">
  <link rel="shortcut icon" href="./favicon.ico">

  <!-- Apple Touch Icon (iOS) -->
  <link rel="apple-touch-icon" sizes="180x180" href="./favicon-pack/apple-touch-icon.png">

  <!-- Web App Manifest -->
  <link rel="manifest" href="./favicon-pack/site.webmanifest">

  <!-- Theme color -->
  <meta name="theme-color" content="#020202">

  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,400;0,9..40,500;0,9..40,700;1,9..40,800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet" />

  <link rel="stylesheet" href="css/style.css?v=12" />

  <script type="importmap">
    {
      "imports": {
        "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
        "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
      }
    }
  </script>
</head>

<body class="access-body">
  <!-- Background -->
  <div class="three-layer" id="threeLayer"></div>
  <div class="screen-overlay"></div>
  <div class="success-flash" id="successFlash" aria-hidden="true"></div>

  <nav class="nav" id="navbar">
    <a href="./index.html" class="nav-logo" aria-label="Nanoker Home">
      <img src="./img/brand/logo-nanoker-26-hd.png" alt="Nanoker">
    </a>

    <div class="nav-center" id="nav-menu">
      <span class="nav-label" data-i18n="nav.sectors">Sectors:</span>
      <a href="./index.html#sec-quantum" class="nav-link" data-i18n="nav.quantum">Quantum</a>
      <a href="./index.html#sec-semi" class="nav-link" data-i18n="nav.semi">Semiconductors</a>
      <a href="./index.html#sec-extreme" class="nav-link" data-i18n="nav.extreme">Defense & Space</a>
      <a href="./index.html#sec-medical" class="nav-link" data-i18n="nav.medical">Medical</a>
    </div>

    <a href="./access.html" class="nav-cta" aria-current="page" data-i18n="nav.partner">Partner Access</a>

    <!-- Language toggle -->
    <button class="nav-lang" id="langToggle" type="button" aria-label="Language">EN</button>
    <button class="nav-toggle" id="navToggle" type="button" aria-label="Open menu" aria-expanded="false">
      ☰ <span class="sr-only">Open menu</span>
    </button>
  </nav>

  <main class="access-page">
    <section class="access-panel" aria-label="Partner Access form">
      <div class="access-accent"></div>

      <div class="access-inner">
        <div class="access-kicker" data-i18n="access.kicker">PRIVATE · PARTNER PORTAL</div>
        <h1 class="access-title" data-i18n="access.title">Partner Access</h1>
        <p class="access-subtitle" data-i18n="access.subtitle">
          Request access to the private materials portal. We review requests manually.
        </p>

        <div class="access-stage" id="accessStage">
          <!-- FORM WRAP -->
          <div id="accessFormWrap">
            <form class="access-form" id="accessForm" autocomplete="on">
              <div class="access-row">
                <label class="access-field">
                  <span class="access-label" data-i18n="access.name">Name</span>
                  <input class="access-input" name="name" type="text" data-i18n-placeholder="access.namePh" placeholder="Full name" required />
                </label>

                <label class="access-field">
                  <span class="access-label" data-i18n="access.company">Company</span>
                  <input class="access-input" name="company" type="text" data-i18n-placeholder="access.companyPh" placeholder="Company / Self-employed" required />
                </label>
              </div>

              <label class="access-field">
                <span class="access-label" data-i18n="access.email">Email</span>
                <input class="access-input" name="email" type="email" data-i18n-placeholder="access.emailPh" placeholder="name@company.com" required />
              </label>

              <label class="access-field">
                <span class="access-label" data-i18n="access.request">Request</span>
                <textarea class="access-textarea" name="message" rows="4" data-i18n-placeholder="access.requestPh" placeholder="Materials / parts of interest"></textarea>
              </label>

              <button class="access-btn" id="submitBtn" type="submit" data-i18n="access.submit">Request access</button>
              <p class="access-note" data-i18n="access.note">Access requests are reviewed manually (24–48h business days).</p>

              <div class="access-toast" id="toast" aria-live="polite"></div>
            </form>
          </div>

          <!-- SUCCESS -->
          <div class="access-success is-hidden" id="accessSuccess" aria-live="polite">
            <div class="access-success-card">
              <div class="access-success-top">
                <div class="access-success-icon" aria-hidden="true">✓</div>
                <h2 class="access-success-title" data-i18n="access.successTitle">Request sent</h2>
              </div>

              <p class="access-success-text" data-i18n="access.successText">
                Your request has been received and is now pending review.
                Please keep an eye on your email (and spam folder).
              </p>

              <div class="access-actions">
                <button class="access-btn secondary" type="button" id="sendAnotherBtn" data-i18n="access.sendAnother">Send another request</button>
                <a class="access-btn" href="./index.html" data-i18n="access.backHome">Back to home</a>
              </div>
            </div>
          </div>
        </div>

      </div>
    </section>
  </main>

  <script>
  (function () {
    const nav = document.querySelector(".nav");
    const btn = document.getElementById("navToggle");
    const links = document.querySelectorAll(".nav-center .nav-link");
    if (!nav || !btn) return;

    btn.addEventListener("click", () => {
      const open = !nav.classList.contains("is-open");
      nav.classList.toggle("is-open", open);
      btn.setAttribute("aria-expanded", open ? "true" : "false");
    });

    links.forEach((link) => {
      link.addEventListener("click", () => {
        nav.classList.remove("is-open");
        btn.setAttribute("aria-expanded", "false");
      });
    });
  })();
  </script>

  <script type="module">
    import { initParticlesBackground } from "./js/three-particles.js";
    import { initLanguageSwitcher, t } from "./js/lang.js";

    // Language init (global)
    initLanguageSwitcher();

    const threeLayer = document.getElementById("threeLayer");
    const flash = document.getElementById("successFlash");

    const particlesController = initParticlesBackground({
      mount: threeLayer,
      count: 12000,
      area: 80,
      height: 22,
      depth: 70,
      baseSize: 0.055
    });

    // Centrado perfecto según altura real del navbar
    const navbar = document.getElementById("navbar");
    if (navbar) {
      const setNavH = () => {
        document.documentElement.style.setProperty("--nav-h", `${navbar.offsetHeight}px`);
      };
      setNavH();
      window.addEventListener("resize", setNavH, { passive: true });
    }

    const form = document.getElementById("accessForm");
    const formWrap = document.getElementById("accessFormWrap");
    const stage = document.getElementById("accessStage");
    const success = document.getElementById("accessSuccess");
    const toast = document.getElementById("toast");
    const submitBtn = document.getElementById("submitBtn");
    const sendAnotherBtn = document.getElementById("sendAnotherBtn");

    const showToast = (msg) => {
      if (!toast) return;
      toast.textContent = msg;
      toast.classList.add("show");
      window.setTimeout(() => toast.classList.remove("show"), 3200);
    };

    const playFlash = () => {
      if (!flash) return;
      flash.classList.remove("play");
      void flash.offsetWidth;
      flash.classList.add("play");
    };

    const lockStageHeight = () => {
      if (!stage) return;
      stage.style.height = stage.offsetHeight + "px";
    };

    const unlockStageHeight = () => {
      if (!stage) return;
      stage.style.height = "";
    };

    const showSuccess = () => {
      lockStageHeight();

      // max-height animable desde la altura real
      formWrap.style.maxHeight = formWrap.scrollHeight + "px";

      requestAnimationFrame(() => {
        formWrap.classList.add("is-hiding");
        formWrap.style.maxHeight = "0px";
      });

      window.setTimeout(() => {
        success.classList.remove("is-hidden");
        success.classList.add("is-show");

        playFlash();

        // Burst en partículas
        particlesController?.pulse?.();

        unlockStageHeight();
      }, 560);
    };

    const resetUI = () => {
      lockStageHeight();

      success.classList.add("is-hidden");
      success.classList.remove("is-show");

      formWrap.classList.remove("is-hiding");
      formWrap.style.maxHeight = formWrap.scrollHeight + "px";

      window.setTimeout(() => {
        form.reset();
        submitBtn.classList.remove("is-loading");
        submitBtn.disabled = false;

        formWrap.style.maxHeight = "";
        unlockStageHeight();

        window.dispatchEvent(new CustomEvent("partner:reset"));
      }, 80);
    };

    sendAnotherBtn?.addEventListener("click", resetUI);

    async function submitFormLikePro(formEl) {
      const action = formEl.getAttribute("action");
      const method = (formEl.getAttribute("method") || "POST").toUpperCase();

      if (!action) {
        await new Promise(r => setTimeout(r, 450));
        return { ok: true, demo: true };
      }

      const formData = new FormData(formEl);

      try {
        const res = await fetch(action, { method, body: formData });
        return { ok: res.ok };
      } catch (e) {
        return { ok: true, corsFallback: true };
      }
    }

    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      submitBtn.classList.add("is-loading");
      submitBtn.disabled = true;

      if (!form.checkValidity()) {
        submitBtn.classList.remove("is-loading");
        submitBtn.disabled = false;
        showToast(t("access.toastRequired"));
        return;
      }

      const result = await submitFormLikePro(form);

      submitBtn.classList.remove("is-loading");
      submitBtn.disabled = false;

      if (!result.ok) {
        showToast(t("access.toastError"));
        return;
      }

      showSuccess();
    });
  </script>
</body>
</html>
